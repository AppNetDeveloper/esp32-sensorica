<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8>
<title>ESP FS Web Server</title>
<meta content="width=device-width, initial-scale=1" name=viewport>
<style>
  html{font-family:sans-serif}body{padding:20px;background-color:#2f4f4f}hr{padding:0}details,main,summary{display:block}a{background-color:transparent}a:active,a:hover{outline:0}b{font-weight:700}h1{font-size:36px;margin:10px 0 5px}h2{font-size:24px}input:-webkit-autofill,input:-webkit-autofill:hover,input:-webkit-autofill:focus,input:-webkit-autofill:active{-webkit-box-shadow:0 0 0 30px #fff inset!important}input[type='checkbox']{box-sizing:border-box;padding:0}input[type='text'],input[type='number'],input[type='password'],select{height:40px;width:90%;padding:0 0 0 20px;border:1px solid #ccc;border-radius:6px;font-size:16px}input[type=file]{display:none}input::placeholder{color:#5e5e5e}input:hover{border-color:rgba(0,0,0,0.8);box-shadow:0 1px 4px 0 rgba(220,220,229,0.9)}input:focus,select:focus{border-color:#3898EC;outline:0}input[type=number]:hover::-webkit-inner-spin-button{-webkit-appearance:none;-moz-appearance:textfield}footer{text-align:center;font-size:12px;margin:40px}button,.btn{display:inline-flex;padding:10px 15px;background-color:#2E8BC0;color:#fff;border:0;cursor:pointer;min-width:40%;border-radius:5px;justify-content:center}button:hover,.btn:hover{filter:brightness(85%)}ul{display:table;text-align:left;margin:0 auto 10px}hr{width:100%;order:997}select{width:92.5%}td svg{width:24px;height:24px}.input-label{align-self:self-start;color:#015293;position:relative;left:5%;bottom:-5px;border-radius:6px;border:1px solid #ccc;background-color:#fff;font-size:13.5px;padding:2px 10px 0}.input-label:hover{border-color:rgba(0,0,0,0.8)}.esp-info{text-align:center;margin-bottom:12px}.row-wrapper{display:flex;flex-wrap:nowrap;align-items:baseline;gap:20px}.loading{color:#ffffff9e;text-align:center}.loader{position:relative;height:auto;overflow:hidden}.spinH{top:50%;position:absolute;height:8px;width:8px;background:#ffffff2b;border-radius:100%}.spin-1H{animation:spinnerH 3s infinite linear}.spin-2H{animation:spinnerH 3s .1s infinite linear}.spin-3H{animation:spinnerH 3s .2s infinite linear}.spin-4H{animation:spinnerH 3s .3s infinite linear}@keyframes spinnerH{0%{transform:translateX(0)}20%{transform:translate(200px)}70%{transform:translateX(505px)}100%{transform:translateX(800px)}}.progress-wrap{text-align:center;position:relative;width:60%;height:25px;margin:20px auto;background:#9e9e9e7d;font-size:20px;transition:all .4s ease}.progress-wrap:not(.active){cursor:pointer;background:#9e9e9e00}.progress-wrap .progress{width:0;z-index:5;background:#9e9e9ea1;opacity:0;transition:all .3s ease}.progress-wrap.active .progress{opacity:1;animation:progress-anim 10s ease 0}.progress-wrap[data-progress-style='fill-back'] .progress{position:absolute;left:0;top:0;right:0;bottom:0}.d-modal{width:-webkit-fill-available;border-radius:10px;border-style:solid;border-width:1px;border-color:#3333336e;box-shadow:rgba(0,0,0,0.24) 0 3px 8px;left:50%;position:absolute;top:60%;transform:translate(-50%,-50%);flex-direction:column;background-color:hsl(199.53deg 18.3% 46.08% / 90%)}.d-modal-title{color:#111827;padding:1.5em;position:relative;width:calc(100% - 4.5em)}.d-modal-content{border-top:1px solid #e0e0e0;padding:1.5em;overflow:auto}.topnav{background-color:#333;overflow:hidden;width:fit-content;float:right;border-radius:5px;align-self:flex-end;bottom:5px;right:20px}.topnav a{float:left;display:block;color:#f2f2f2;text-align:center;padding:5px 10px;text-decoration:none;font-size:16px}.topnav a:hover{filter:brightness(55%);cursor:pointer}.topnav a.active{background-color:#56c080;color:#fff}.topnav .icon{display:none}.logo{width:100%}.lbl-wifi{align-self:flex-end}.table{width:90%;margin:auto;border-collapse:collapse;border-spacing:0}.svg{display:flex;width:20px;margin-right:10px}.svg-e{margin-top:5px}.output{color:#fff}.form{padding:10px 0;width:85%;text-align:center}.ctn:before,.ctn:after{content:" ";display:table;grid-column-start:1;grid-row-start:1;grid-column-end:2;grid-row-end:2}.ctn:after{clear:both}.ctn{display:flex;flex-direction:column;position:relative;overflow:visible;max-width:960px;margin:0 auto 10px;padding:10px 40px;border-radius:10px;border:1px solid;background-color:hsla(0,0%,100%,0.7);box-shadow:rgba(0,0,0,0.24) 0 3px 8px}.btn-bar{display:flex;padding:20px;justify-content:center;flex-wrap:wrap;grid-column-gap:30px;grid-row-gap:20px;order:998}.tf-wrapper{display:flex;margin-bottom:10px;flex-direction:column;align-items:center}.title{display:flex}.heading{width:100%;text-align:right;margin-right:0}.heading-2{font-weight:400;text-align:center;margin:10px auto;color:#0d4869}.toggle{cursor:pointer;display:block;padding:4px;width:fit-content;margin:0 0 18px -10px}.toggle-label{margin:0 20px;position:relative;top:2px}.toggle-switch{display:inline-block;background:#ccc;border-radius:16px;width:58px;height:32px;position:relative;vertical-align:middle;transition:background .25s}.toggle-switch:before,.toggle-switch:after{content:""}.toggle-switch:before{display:block;background:linear-gradient(to bottom,#fff 0%,#eee 100%);border-radius:50%;box-shadow:0 0 0 1px rgba(0,0,0,0.25);width:24px;height:24px;position:absolute;top:4px;left:4px;transition:left .25s}.toggle:hover .toggle-switch:before{background:linear-gradient(to bottom,#fff 0%,#fff 100%);box-shadow:0 0 0 1px rgba(0,0,0,0.5)}.t-check:checked+.toggle-switch{background:#56c080}.t-check:checked+.toggle-switch:before{left:30px}.t-check{position:absolute;visibility:hidden}.pswd{display:flex;flex-direction:row;align-items:center;width:100%;justify-content:center}.show-hide-wrap{position:absolute;right:8%;cursor:pointer}.firmware{display:flex;flex-direction:column;align-items:center}.fw-upload{display:inline-block;padding:12px 20px;cursor:pointer;border-radius:5px;margin-bottom:20px;background:#696969;color:#fff}.fw-upload:hover{filter:brightness(85%)}.btn,.submit{min-width:25%}#about{color:lightgray}#esp-ip{display:inline-block;margin-bottom:5px}@media screen and (max-width: 991px){.wifi-connect{padding-right:20px;padding-left:20px}}@media screen and (max-width: 767px){.wifi-connect{padding-right:10px;padding-left:10px}select{width:93.5%}}@media screen and (max-width: 608px){h1{font-size:24px}.btn-bar{margin-top:20px;flex-direction:column}.topnav{margin-bottom:5px;width:55%}.topnav a{padding:5px 20px}.topnav a:not(.active){display:none}.topnav a.icon{float:right;display:block}.topnav.responsive .icon{position:absolute;right:0;top:0}.topnav.responsive a{float:none;display:block;text-align:left}.hide-tiny{display:none}.toggle-label{margin:0 5px}.show-hide-wrap{right:4%}}@media screen and (max-width: 479px){body{padding:2px}select{width:95.5%}.heading-2{margin-top:10px;padding:0}.form{padding:0}.ctn{max-width:100%;padding:0 10px}.row-wrapper{flex-direction:column;gap:0}}.hide{display:none}
</style>
</head>
<body>
<main id=main-box>
<header class=ctn>
<div class=title>
<div id=img-logo title='Click to upload your logo file'></div>
<div class=heading>
<h1 id=name-logo>ESP FS Web Server</h1>
<span id=esp-ip></span><br>
<span id=esp-mode></span> - v<span id=firmware></span>
</div>
</div>
<div class=topnav id=top-nav>
<span id=nav-link><a id=set-wifi class="a-link active" data-box=wifi-box>WiFi Setup</a></span>
<span id=upd-link><a id=set-update class=a-link data-box=update-box>Update & FS</a></span>
<a class="a-link icon" id=hum-btn>
<div class=svg style=margin:-2px>
<svg id=svg-menu height=16pt fill=currentColor viewBox="0 0 20 18"></svg>
</div>
</a>
</div>
</header>
<div id=wifi-box class="ctn opt-box">
<h2 class=heading-2>Connect to WiFi</h2>
<div id=wifi-table class=hide>
<hr>
<table class=table>
<tbody id=wifi-list></tbody>
</table>
<br>
</div>
<div id=wifi>
<div class=tf-wrapper>
<label for=ssid class=input-label>SSID</label>
<input type=text placeholder="Enter your WiFI SSID name" id=ssid>
</div>
<div class=tf-wrapper>
<label for=password class=input-label>Password</label>
<div class=pswd>
<input type=password placeholder="Enter your WiFi password" id=password autocomplete=current-password data-ms-member=password>
<span class=show-hide-wrap id=show-hide-password>
<a class="show-hide hide" id=show-pass>
<div class=svg><svg class=svg-e id=svg-eye viewBox="0 0 24 24"></svg></div>
</a>
<a class=show-hide id=hide-pass>
<div class=svg><svg class=svg-e id=svg-no-eye viewBox="0 0 24 24"></svg></div>
</a>
</span>
</div>
</div>
<div class=tf-wrapper>
<label class="input-label toggle">
<input id=no-dhcp type=checkbox class=t-check>
<div class=toggle-switch></div>
<span class=toggle-label>Manual configuration (no DHCP)</span>
</label>
</div>
<div class=hide id=conf-wifi>
<div class=tf-wrapper>
<label for=ip class=input-label>IP Address</label>
<input type=text placeholder="IP Address" id=ip value=192.168.0.10>
</div>
<div class=tf-wrapper>
<label for=gateway class=input-label>Gateway</label>
<input type=text placeholder="Gateway address" id=gateway value=192.168.0.1>
</div>
<div class=tf-wrapper>
<label for=subnet class=input-label>Subnet</label>
<input type=text placeholder="Subnet mask" id=subnet value=255.255.255.0>
</div>
</div>
<div class=tf-wrapper>
<label class="lbl-wifi toggle">
<input id=persistent type=checkbox class=t-check checked>
<div class=toggle-switch></div>
<span class=toggle-label>Store WiFi credentials</span>
</label>
</div>
</div>
<hr>
<div class=btn-bar>
<a id=scan-wifi class=btn>
<div class=svg><svg id=svg-scan fill=currentColor viewBox="0 0 24 24"></svg></div>
<span>Scan WiFi networks</span>
</a>
<a id=connect-wifi class=btn>
<div class=svg><svg id=svg-connect fill=currentColor viewBox="0 0 24 24"></svg></div>
<span>Connect to <span id=ssid-name>SSID</span></span>
</a>
<a id=save-wifi class="btn hide">
<div class=svg><svg id=svg-save2 fill=currentColor viewBox="0 0 24 24"></svg></div>
<span>Save configuration</span>
</a>
</div>
</div>
<div id=update-box class="ctn opt-box hide">
<h2 class=heading-2>Update ESP Firmware</h2>
<div class=tf-wrapper>
<form id=update-form class=form action=/update method=post enctype=multipart/form-data>
<div class=firmware>
<label for=file-input id=fw-label class=fw-upload>Select firmware binary file</label>
<input id=file-input type="file"/>
<a id=update-btn class="btn submit">
<div class=svg>
<svg fill=currentColor viewBox="0 0 24 24"><path d="M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z"/></svg>
</div>
<span>Submit!</span>
</a><br>
</div>
<div class="progress-wrap hide" id=progress-wrap data-progress-style=fill-back>
<div id=update-log></div>
<div class=progress id=progress-anim></div>
</div>
</form>
</div>
<h2 class=heading-2>Load file to ESP FileSystem</h2>
<div class=tf-wrapper>
<form class=form action=/edit method=post enctype=multipart/form-data>
<ul id=listing></ul>
<label for=picker id=pick-label class=fw-upload>Select the folder containing your files</label>
<input type=file id=picker name=fileList webkitdirectory multiple>
<p>N.B.: if folder name is <b>"/data"</b>, the files will be uploaded at root "/" level </p>
</form>
</div>
</div>
<hr id=btn-hr class=hide>
<div id=btn-box class="btn-bar hide">
<a id=restart class=btn>
<div class=svg><svg id=svg-restart fill=currentColor viewBox="0 0 24 24"></svg></div>
<span>Restart ESP</span>
</a>
<a id=save-params class=btn>
<div class=svg><svg id=svg-save fill=currentColor viewBox="0 0 24 24"></svg></div>
<span>Save configuration</span>
</a>
</div>
</main>
<div class="loader hide" id=loader>
<div class=loading>Loading...</div>
<div class="spinH spin-1H"></div>
<div class="spinH spin-2H"></div>
<div class="spinH spin-3H"></div>
<div class="spinH spin-4H"></div>
</div>
<details id=modal-message>
<summary></summary>
<div class=d-modal>
<div class=d-modal-title><h2 id=message-title>t</h2></div>
<div class=d-modal-content><p id=message-body></p></div>
<div class=btn-bar>
<a id=ok-modal class="btn hide" onclick=closeModal(true)><span>OK</span></a>
<a id=close-modal class=btn onclick=closeModal(false)><span>Close</span></a>
</div>
</div>
</details>
<footer class=foot>
<hr>Created with <a id=about target=_blank rel=noopener></a>
</footer>
<script>
  const svgLogo='<svg fill="brown" height=120px viewBox="0 0 24 24"><path d="M5 3C3.9 3 3 3.9 3 5S2.1 7 1 7V9C2.1 9 3 9.9 3 11S3.9 13 5 13H7V11H5V10C5 8.9 4.1 8 3 8C4.1 8 5 7.1 5 6V5H7V3M11 3C12.1 3 13 3.9 13 5S13.9 7 15 7V9C13.9 9 13 9.9 13 11S12.1 13 11 13H9V11H11V10C11 8.9 11.9 8 13 8C11.9 8 11 7.1 11 6V5H9V3H11M22 6V18C22 19.11 21.11 20 20 20H4C2.9 20 2 19.11 2 18V15H4V18H20V6H17.03V4H20C21.11 4 22 4.89 22 6Z" /></svg>',svgLock='<svg viewBox="0 0 24 24"><path d="M12 17a2 2 0 1 0 0-4 2 2 0 1 0 0 4m6-9a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V10a2 2 0 0 1 2-2h1V6a5 5 0 1 1 10 0v2h1m-6-5a3 3 0 0 0-3 3v2h6V6a3 3 0 0 0-3-3z"/></svg>',svgUnlock='<svg viewBox="0 0 24 24"><path d="M18 8a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V10a2 2 0 0 1 2-2h9V6a3 3 0 1 0-6 0H7a5 5 0 1 1 10 0v2h1m-6 9a2 2 0 1 0 0-4 2 2 0 1 0 0 4z"/></svg>',svgScan='<path d="M12 20l-3.6-4.8a5.99 5.99 0 0 1 7.2 0L12 20m-7.2-9.6l1.8 2.4A8.94 8.94 0 0 1 12 11a8.94 8.94 0 0 1 5.4 1.8l1.8-2.4C17.19 8.89 14.7 8 12 8s-5.19.89-7.2 2.4M12 2C7.95 2 4.21 3.34 1.2 5.6L3 8a14.93 14.93 0 0 1 9-3 14.93 14.93 0 0 1 9 3l1.8-2.4C19.79 3.34 16.05 2 12 2M7 24h2v-2H7v2m8 0h2v-2h-2v2m-4 0h2v-2h-2v2z"/>',svgConnect='<path d="M12 21l3.6-4.8a5.99 5.99 0 0 0-7.2 0L12 21m0-18C7.95 3 4.21 4.34 1.2 6.6L3 9a14.93 14.93 0 0 1 9-3 14.93 14.93 0 0 1 9 3l1.8-2.4C19.79 4.34 16.05 3 12 3m0 6c-2.7 0-5.19.89-7.2 2.4l1.8 2.4A8.94 8.94 0 0 1 12 12a8.94 8.94 0 0 1 5.4 1.8l1.8-2.4C17.19 9.89 14.7 9 12 9z"/>',svgSave='<path d="M15 9H5V5h10m-3 14a3 3 0 1 1 0-6 3 3 0 1 1 0 6m5-16H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7l-4-4z"/>',svgRestart='<path d="M16.56 5.44l-1.45 1.45C16.84 7.94 18 9.83 18 12a6 6 0 1 1-12 0c0-2.17 1.16-4.06 2.88-5.12L7.44 5.44A7.96 7.96 0 0 0 4 12a8 8 0 1 0 16 0 7.96 7.96 0 0 0-3.44-6.56M13 3h-2v10h2"/>',svgNoEye='<path d="M12 9a3 3 0 1 0 0 6 3 3 0 1 0 0-6m0 8a5 5 0 1 1 0-10 5 5 0 1 1 0 10m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5z"/>',svgEye='<path d="M12 9a3 3 0 1 1 0 6 3 3 0 1 1 0-6m0-4.5c5 0 9.27 3.11 11 7.5-1.73 4.39-6 7.5-11 7.5S2.73 16.39 1 12c1.73-4.39 6-7.5 11-7.5M3.18 12a9.82 9.82 0 0 0 17.64 0 9.82 9.82 0 0 0-17.64 0z"/>',svgMenu='<path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"/>';var configFile,lastBox,closeCb=function(){},port=location.port||("https:"===window.location.protocol?"443":"80"),esp=`${window.location.protocol}//${window.location.hostname}:${port}/`,options={},$=function(e){return document.getElementById(e)};function hide(e){$(e).classList.add("hide")}function show(e){$(e).classList.remove("hide")}function newEl(e,t){var a=document.createElement(e);if("object"==typeof t)for(var n in t)a.setAttribute(n,t[n]);return a}function getParameters(){var e;show("loader"),fetch(esp+"getStatus").then(e=>e.json()).then(t=>{$("esp-mode").innerHTML=t.mode,$("esp-ip").innerHTML=`<a href="${esp}">${esp}</a>`,$("firmware").innerHTML=t.firmware,$("about").innerHTML=t.liburl,$("about").setAttribute("href",t.liburl),fetch(esp+(configFile=t.path)).then(e=>e.json()).then(t=>{for(let a in t)if(t.hasOwnProperty(a)){if("name-logo"===a){$("name-logo").innerHTML=t[a].replace(/(<([^>]+)>)/ig,""),document.title=t[a].replace(/(<([^>]+)>)/ig,""),delete t[a];continue}if("img-logo"==a){e=t[a],delete t[a];continue}}e&&fetch(e).then(e=>e.text()).then(t=>setLogoBase64(e,t)),createOptionsBox(options=t),hide("loader")})})}function setLogoBase64(e,t){var a=e.replace(/[^\d_]/g,"").split("_"),n=newEl("img",{class:"logo",src:"data:image/png;base64, "+t,style:`width:${a[0]}px;height:${a[1]}px`});$("img-logo").innerHTML="",$("img-logo").append(n),$("img-logo").setAttribute("type","number"),$("img-logo").setAttribute("title","")}function addOptionsElement(e){let t=Object.keys(e).filter(t=>"boolean"==typeof e[t]).reduce((t,a)=>(t[a]=e[a],t),{});if(0!==Object.entries(t).length){var a=newEl("div",{class:"row-wrapper"});Object.entries(t).forEach(([e,t])=>{let n=newEl("label",{class:"input-label toggle"}),i=newEl("input",{class:"t-check opt-input",type:"checkbox",id:e});i.checked=t;let _=newEl("div",{class:"toggle-switch"}),s=newEl("span",{class:"toggle-label"});s.textContent=e,n.appendChild(i),n.appendChild(_),n.appendChild(s),addInputListener(i),a.appendChild(n)}),lastBox.appendChild(a)}let n=Object.keys(e).filter(t=>"boolean"!=typeof e[t]).reduce((t,a)=>(t[a]=e[a],t),{});Object.entries(n).forEach(([e,t])=>{let a=newEl("label",{class:"input-label","label-for":e});a.textContent=e;let n=newEl("input",{class:"opt-input",type:"text",id:e});if(n.value=t,"number"==typeof t&&n.setAttribute("type","number"),"object"==typeof t){if(t.values)n=newEl("select",{id:e}),t.values.forEach(e=>{var t=newEl("option");t.textContent=e,t.value=e,n.appendChild(t)}),n.value=t.selected,lastBox.appendChild(n);else{var i=Math.round(t.value*(1/t.step))/(1/t.step);n.setAttribute("type","number"),n.setAttribute("step",t.step),n.setAttribute("min",t.min),n.setAttribute("max",t.max),n.value=Number(i).toFixed(3)}}addInputListener(n);var _=newEl("div",{class:"tf-wrapper"});_.appendChild(a),_.appendChild(n),lastBox.appendChild(_),e.endsWith("-hidden")&&_.classList.add("hide")})}function createNewBox(e,t){var a=newEl("div",{class:"ctn opt-box hide",id:"option-box"+e}),n=newEl("h2",{class:"heading-2"});n.innerHTML=t,a.appendChild(n),$("main-box").appendChild(a);var i=newEl("a",{class:"a-link",id:"set-opt"+e,"data-box":"option-box"+e});return i.innerHTML=t,i.addEventListener("click",switchPage),$("nav-link").appendChild(i),a}async function createOptionsBox(e){var t={},a="wifi-box";lastBox=$(a),Object.entries(e).forEach(([n,i],_)=>{if("wifi-box"===a&&($("no-dhcp").checked=e.dhcp,$("ip").value=e.ip_address,$("gateway").value=e.gateway,$("subnet").value=e.subnet,$("no-dhcp").checked&&(show("conf-wifi"),show("save-wifi"))),n.startsWith("param-box"))addOptionsElement(t),lastBox=createNewBox(_,i),t={},a=i;else if("wifi-box"!=a){var s=!1;if(n.startsWith("img-logo")||n.startsWith("name-logo"))s=!0;else if(n.startsWith("raw-css")){var o=newEl("link",{rel:"stylesheet",href:i});document.head.appendChild(o),s=!0}else if(n.startsWith("raw-javascript")){var r=newEl("script",{src:i});document.body.appendChild(r),s=!0}else if(n.startsWith("raw-html")){var d=newEl("div",{class:"tf-wrapper raw-html",id:i,"data-box":lastBox.id});lastBox.appendChild(d),fetch(i).then(e=>e.text()).then(e=>$(i).innerHTML=e),s=!0}s||(t[n]=i)}}),0!==Object.entries(t).length&&addOptionsElement(t)}function addInputListener(e){if("number"===e.type){e.addEventListener("change",()=>{if(e.getAttribute("step")){var t={};t.value=Math.round(e.value*(1/e.step))/(1/e.step),t.step=e.getAttribute("step"),t.min=e.getAttribute("min"),t.max=e.getAttribute("max"),options[e.id]=t}else options[e.id]=parseInt(e.value)});return}if("text"===e.type){e.addEventListener("change",()=>{options[e.id]=e.value});return}if("checkbox"===e.type){e.addEventListener("change",()=>{options[e.id]=e.checked});return}if("select-one"===e.type){e.addEventListener("change",e=>{options[e.target.id].selected=e.target.value});return}}function insertKey(e,t,a,n){return Object.keys(a).reduce((i,_,s)=>(s===n&&(i[e]=t),i[_]=a[_],i),{})}function saveParameters(){Object.keys(options)[0].startsWith("param-box")&&("param-box0"===Object.keys(options)[0]?(options["param-box-0"]=options["wifi-box"],options={dhcp:!1,...options}):options={"wifi-box":"",dhcp:!1,...options}),options.dhcp=$("no-dhcp").checked,$("no-dhcp").checked&&(options=insertKey("ip_address",$("ip").value,options,2),options=insertKey("gateway",$("gateway").value,options,3),(options=insertKey("subnet",$("subnet").value,options,4)).ip_address=$("ip").value,options.gateway=$("gateway").value,options.subnet=$("subnet").value);var e=new Blob([JSON.stringify(options,null,2)],{type:"application/json"}),t=new FormData;t.append("data",e,"/"+configFile),fetch("/edit",{method:"POST",body:t}).then(e=>e.text()).then(e=>{openModal("Save options",'<br><b>"/'+configFile+'"</b> saved successfully on flash memory!<br><br>')})}function showHidePassword(){var e=$("password");"password"===e.type?(e.type="text",show("show-pass"),hide("hide-pass")):(e.type="password",hide("show-pass"),show("hide-pass"))}function getWiFiList(){show("loader"),fetch(esp+"scan").then(e=>e.json()).then(e=>{listWifi(e),hide("loader")})}function selectWifi(e){try{$("select-"+e.target.parentNode.id).checked=!0}catch(t){$(e.target.id).checked=!0}$("ssid").value=this.cells[1].innerHTML,$("ssid-name").innerHTML=this.cells[1].innerHTML,$("password").focus()}function listWifi(e){e.hasOwnProperty("reload")&&setTimeout(getWiFiList,2e3),e.sort((e,t)=>t.strength-e.strength);let t=document.querySelector("#wifi-list");t.innerHTML="",e.forEach((e,a)=>{var n=newEl("tr"),i="wifi-"+a;n.id=i,n.addEventListener("click",selectWifi),n.innerHTML=`<td><input type="radio" name="select" id="select-${i}"></td>`,n.innerHTML+=`<td id="ssid-${i}">${e.ssid}</td>`,n.innerHTML+='<td class="hide-tiny">'+e.strength+" dBm</td>",n.innerHTML+=e.security?'<td><svg viewBox="0 0 24 24"><path d="M12 17a2 2 0 1 0 0-4 2 2 0 1 0 0 4m6-9a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V10a2 2 0 0 1 2-2h1V6a5 5 0 1 1 10 0v2h1m-6-5a3 3 0 0 0-3 3v2h6V6a3 3 0 0 0-3-3z"/></svg></td>':'<td><svg viewBox="0 0 24 24"><path d="M18 8a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V10a2 2 0 0 1 2-2h9V6a3 3 0 1 0-6 0H7a5 5 0 1 1 10 0v2h1m-6 9a2 2 0 1 0 0-4 2 2 0 1 0 0 4z"/></svg></td>',t.appendChild(n)}),show("wifi-table")}function doConnection(e,t){if(""===$("ssid").value||""===$("password").value){openModal("Connect to WiFi","Please insert a SSID and a Password");return}var a,n=new FormData;n.append("ssid",$("ssid").value),n.append("password",$("password").value),n.append("persistent",$("persistent").checked),void 0!==t&&n.append("newSSID",!0),$("no-dhcp").checked&&(n.append("ip_address",$("ip").value),n.append("gateway",$("gateway").value),n.append("subnet",$("subnet").value)),show("loader"),fetch("/connect",{method:"POST",body:n,redirect:"follow"}).then(function(e){return a=e.status,e.text()}).then(function(t){200===a?t.includes("already")?openModal("Connect to WiFi",t,()=>{doConnection(e,!0)}):openModal("Connect to WiFi",t,restartESP):openModal("Error!",t),hide("loader")}).catch(e=>{openModal("Connect to WiFi",e),hide("loader")})}function switchPage(e){if($("top-nav").classList.remove("resp"),document.querySelectorAll("a").forEach(e=>{e.classList.remove("active")}),e.target.classList.add("active"),document.querySelectorAll(".opt-box").forEach(e=>{e.classList.add("hide")}),show(e.target.getAttribute("data-box")),"set-wifi"!=e.target.id){var t=document.createDocumentFragment();t.appendChild($("btn-hr")),t.appendChild($("btn-box"));let a=$(e.target.getAttribute("data-box"));a.appendChild(t),document.querySelectorAll(".raw-html").forEach(function(e){e.getAttribute("data-box")===a.id&&a.insertBefore(e,$("btn-hr"))}),show("btn-box"),show("btn-hr")}else hide("btn-box"),hide("btn-hr")}function showMenu(){$("top-nav").classList.add("resp")}function openModal(e,t,a,n){$("message-title").innerHTML=e,$("message-body").innerHTML=t,$("modal-message").open=!0,$("main-box").style.filter="blur(3px)",void 0!==a?(closeCb=a,show("ok-modal")):hide("ok-modal")}function closeModal(e){$("modal-message").open=!1,$("main-box").style.filter="",void 0!==closeCb&&e&&closeCb()}function restartESP(){fetch(esp+"reset").then(e=>e.text()).then(e=>{closeModal(),openModal("Restart!","<br>ESP restarted!")})}function handleSubmit(){let e=$("file-input");if(0===e.files.length){alert("please choose a file");return}var t=$("update-log");$("loader"),$("progress-wrap"),show("loader"),show("progress-wrap"),$("progress-wrap").classList.add("active"),t.innerHTML="Update in progress";let a=new FormData;a.set("update",e.files[0]);var n=new XMLHttpRequest;n.open("POST","/update?size="+e.files[0].size),n.onload=function(e){hide("loader"),$("progress-wrap").classList.remove("active"),t.innerHTML=200!=n.status?`Error ${n.status}: ${n.statusText}`:n.response},n.upload.addEventListener("progress",e=>{let a=Math.round(e.loaded/e.total*100)+"%";e.lengthComputable&&($("progress-anim").style.width=a,t.innerHTML="Update in progress: "+a)}),n.send(a)}async function uploadFolder(e){let t=$("listing");for(let a of Array.from(e.target.files)){let n=a.webkitRelativePath,i=newEl("li");i.textContent=n,t.appendChild(i);var _=new FileReader;_.onload=function(e){n.startsWith("data/")&&(n=n.replace("data/",""));var t=new FormData;t.set("data",a,"/"+n),fetch("/edit",{method:"POST",body:t}).then(e=>e.text())},_.readAsText(a)}}$("svg-menu").innerHTML='<path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"/>',$("svg-eye").innerHTML='<path d="M12 9a3 3 0 1 1 0 6 3 3 0 1 1 0-6m0-4.5c5 0 9.27 3.11 11 7.5-1.73 4.39-6 7.5-11 7.5S2.73 16.39 1 12c1.73-4.39 6-7.5 11-7.5M3.18 12a9.82 9.82 0 0 0 17.64 0 9.82 9.82 0 0 0-17.64 0z"/>',$("svg-no-eye").innerHTML='<path d="M12 9a3 3 0 1 0 0 6 3 3 0 1 0 0-6m0 8a5 5 0 1 1 0-10 5 5 0 1 1 0 10m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5z"/>',$("svg-scan").innerHTML='<path d="M12 20l-3.6-4.8a5.99 5.99 0 0 1 7.2 0L12 20m-7.2-9.6l1.8 2.4A8.94 8.94 0 0 1 12 11a8.94 8.94 0 0 1 5.4 1.8l1.8-2.4C17.19 8.89 14.7 8 12 8s-5.19.89-7.2 2.4M12 2C7.95 2 4.21 3.34 1.2 5.6L3 8a14.93 14.93 0 0 1 9-3 14.93 14.93 0 0 1 9 3l1.8-2.4C19.79 3.34 16.05 2 12 2M7 24h2v-2H7v2m8 0h2v-2h-2v2m-4 0h2v-2h-2v2z"/>',$("svg-connect").innerHTML='<path d="M12 21l3.6-4.8a5.99 5.99 0 0 0-7.2 0L12 21m0-18C7.95 3 4.21 4.34 1.2 6.6L3 9a14.93 14.93 0 0 1 9-3 14.93 14.93 0 0 1 9 3l1.8-2.4C19.79 4.34 16.05 3 12 3m0 6c-2.7 0-5.19.89-7.2 2.4l1.8 2.4A8.94 8.94 0 0 1 12 12a8.94 8.94 0 0 1 5.4 1.8l1.8-2.4C17.19 9.89 14.7 9 12 9z"/>',$("svg-save").innerHTML=svgSave,$("svg-save2").innerHTML=svgSave,$("svg-restart").innerHTML='<path d="M16.56 5.44l-1.45 1.45C16.84 7.94 18 9.83 18 12a6 6 0 1 1-12 0c0-2.17 1.16-4.06 2.88-5.12L7.44 5.44A7.96 7.96 0 0 0 4 12a8 8 0 1 0 16 0 7.96 7.96 0 0 0-3.44-6.56M13 3h-2v10h2"/>',$("img-logo").innerHTML='<svg fill="brown" height=120px viewBox="0 0 24 24"><path d="M5 3C3.9 3 3 3.9 3 5S2.1 7 1 7V9C2.1 9 3 9.9 3 11S3.9 13 5 13H7V11H5V10C5 8.9 4.1 8 3 8C4.1 8 5 7.1 5 6V5H7V3M11 3C12.1 3 13 3.9 13 5S13.9 7 15 7V9C13.9 9 13 9.9 13 11S12.1 13 11 13H9V11H11V10C11 8.9 11.9 8 13 8C11.9 8 11 7.1 11 6V5H9V3H11M22 6V18C22 19.11 21.11 20 20 20H4C2.9 20 2 19.11 2 18V15H4V18H20V6H17.03V4H20C21.11 4 22 4.89 22 6Z" /></svg>',$("hum-btn").addEventListener("click",showMenu),$("scan-wifi").addEventListener("click",getWiFiList),$("connect-wifi").addEventListener("click",doConnection),$("save-params").addEventListener("click",saveParameters),$("save-wifi").addEventListener("click",saveParameters),$("show-hide-password").addEventListener("click",showHidePassword),$("set-wifi").addEventListener("click",switchPage),$("set-update").addEventListener("click",switchPage),$("about").addEventListener("click",switchPage),$("restart").addEventListener("click",restartESP),$("picker").addEventListener("change",uploadFolder),$("update-btn").addEventListener("click",handleSubmit),$("file-input").addEventListener("change",()=>{$("fw-label").innerHTML=$("file-input").files.item(0).name+" ("+$("file-input").files.item(0).size+" bytes)",$("fw-label").style.background="brown"}),$("no-dhcp").addEventListener("change",function(){this.checked?(show("conf-wifi"),show("save-wifi")):hide("conf-wifi")}),window.addEventListener("load",getParameters);
</script>
</body>
</html>